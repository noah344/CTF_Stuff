# Web Gauntlet
This was a challenge for PicoMini 2020.  It's listed as Medium and categorized as a Web Exploitation challenge.  
Direct Link: https://play.picoctf.org/practice/challenge/88

## Description
The Description reads:
> Can you beat the filters? Log in as admin http://jupiter.challenges.picoctf.org:19593/ http://jupiter.challenges.picoctf.org:19593/filter.php

## Hints
There are five hints:
> You are not allowed to login with valid credentials.
> Write down the injections you use in case you lose your progress.
> For some filters it may be hard to see the characters, always (always) look at the raw hex in the response.
> sqlite
> If your cookie keeps getting reset, try using a private browser window

# Solving
## My Thoughts
This is a great challenge for learning some methods of filter evasion for SQL injection.  Had I realized that (duh) the filter.php file wasn't saying I should try 'or' and instead was saying 'or' was filtered, I would have finished this much faster!

## Webpage
Let's start by looking at the main web page and source code:

![Webpage](https://github.com/user-attachments/assets/cea625c2-0794-4b03-ac16-0e1c1710c31c)

``` html
<!DOCTYPE html>
<html>
<head>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link href="style.css" rel="stylesheet">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
					<div class="card card-signin my-5">
						<div class="card-body">
							<h5 class="card-title text-center">Round 1 / 5</h5>
														<form class="form-signin" action="index.php" method="post">
								<div class="form-label-group">
									<input type="text" id="user" name="user" class="form-control" placeholder="Username" required autofocus>
									<label for="user">Username</label>
								</div>

								<div class="form-label-group">
									<input type="password" id="pass" name="pass" class="form-control" placeholder="Password" required>
									<label for="pass">Password</label>
								</div>

								<button class="btn btn-lg btn-primary btn-block text-uppercase" type="submit">Sign in</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
```

Nothing super useful.  There is a single cookie that seems like it may be relevant:

![Cookie](https://github.com/user-attachments/assets/30863e38-b821-4afb-b9dd-35859d016647)

Let's try entering in some junk and see what we get:

![Weird](https://github.com/user-attachments/assets/c7f238d9-3355-49d5-9c1c-41c565f4afe4)

Ok, that's weird.  So it looks like it does a standard sql lookup.  Let's try to break out and get some info.  In sql, the '--' characters can be used to comment out sections of your code.  Let's try to login as admin using this method:

![First](https://github.com/user-attachments/assets/3dd76b71-7b4e-4ef2-bd1c-b12c3b1783c2)

![First_Success](https://github.com/user-attachments/assets/9aabb2bb-bccd-4cc4-bdf6-03fe46e35e10)

Success!

## Second

What I hadn't realized at first was that the second page provided gave us hints as to what the filters were, so we can see here that on challenge 2 it's blocking several things:

![filter.php](https://github.com/user-attachments/assets/07a625b6-90a1-4802-9915-a957fbb59980)

So our next injection can't use the below:

- or
- and
- like
- =
- --

After a bit of research into sqlite, there's a second way we can send comment using /* and */.  Let's give it a try:

![Injection](https://github.com/user-attachments/assets/7e5dcdac-fc2b-4827-aa6e-f5c23fede163)

![Success](https://github.com/user-attachments/assets/b07199cd-f7f8-4acd-bad8-3fc2bdb1ce0c)

Nice, onto number 3.

## Third
The new filters are:

- or
- and
- =
- like
- \>
- <
- \--

Well our comment still works for this one so we easily get to round 4!

![Success](https://github.com/user-attachments/assets/cce5407a-338a-4a72-a484-27f8c97b008f)

## Fourth
The filters on this one will make things a little tricky:
- or
- and
- =
- like
- \>
- <
- \--
- admin

So we need to login as admin...but can't send the word admin.  Sqlite has a neat little operator '||' that concatenates two strings together.  Let's see if this bypasses the filter:

![Fourth](https://github.com/user-attachments/assets/f6a33b94-a346-48c6-aeba-49d85cc1ad71)

![Success](https://github.com/user-attachments/assets/9207fcb9-c493-4e07-a65a-40947078cbe7)

Awesome! On to the fifth one.

## Fifth
Let's take a look at filters:

- or
- and
- =
- like
- \>
- <
- \--
- union
- admin

Once again, our previous injection works just fine!

![Success](https://github.com/user-attachments/assets/b84484c6-6fe0-4021-a6ea-bed292afe75b)

Let's check out the filter file like it says:

``` php
 <?php
session_start();

if (!isset($_SESSION["round"])) {
    $_SESSION["round"] = 1;
}
$round = $_SESSION["round"];
$filter = array("");
$view = ($_SERVER["PHP_SELF"] == "/filter.php");

if ($round === 1) {
    $filter = array("or");
    if ($view) {
        echo "Round1: ".implode(" ", $filter)."<br/>";
    }
} else if ($round === 2) {
    $filter = array("or", "and", "like", "=", "--");
    if ($view) {
        echo "Round2: ".implode(" ", $filter)."<br/>";
    }
} else if ($round === 3) {
    $filter = array(" ", "or", "and", "=", "like", ">", "<", "--");
    // $filter = array("or", "and", "=", "like", "union", "select", "insert", "delete", "if", "else", "true", "false", "admin");
    if ($view) {
        echo "Round3: ".implode(" ", $filter)."<br/>";
    }
} else if ($round === 4) {
    $filter = array(" ", "or", "and", "=", "like", ">", "<", "--", "admin");
    // $filter = array(" ", "/**/", "--", "or", "and", "=", "like", "union", "select", "insert", "delete", "if", "else", "true", "false", "admin");
    if ($view) {
        echo "Round4: ".implode(" ", $filter)."<br/>";
    }
} else if ($round === 5) {
    $filter = array(" ", "or", "and", "=", "like", ">", "<", "--", "union", "admin");
    // $filter = array("0", "unhex", "char", "/*", "*/", "--", "or", "and", "=", "like", "union", "select", "insert", "delete", "if", "else", "true", "false", "admin");
    if ($view) {
        echo "Round5: ".implode(" ", $filter)."<br/>";
    }
} else if ($round >= 6) {
    if ($view) {
        highlight_file("filter.php");
    }
} else {
    $_SESSION["round"] = 1;
}

// picoCTF{y0u_m4d3_1t_cab35b843fdd6bd889f76566c6279114}
?>
```

We can see the full filter logic and the flag!
